# JsoupAndPOI
###### 因舊的沒備份到，因此新做一個爬蟲，也是回溫複習
### - 當初的動機 
---
###### (在此 A 品牌購物簡稱A，B品牌購物簡稱B)
 當時有個 A 網站要併到B網站裡，用人工處理會不符合效益，~~(好啦~其實剛好有機會我是想練練程式 誤)~~<br>
 是因為有4點困難點: <br>
1. A 網站租約快到期，老闆不想繼續使用。 ~~(此事引爆點)~~ <br>
2. 當時出貨量爆多，無法擠出一人專門處理。 <br>
3. A 網站可匯出資料成 xlsx 檔， B 網站也能用 xlsx 檔上傳新增商品，但並非只需商品名稱及庫存量，還需要商品描述跟圖片，所以 A 網站匯出的資料無法滿足 B 網站需求。<br>
4. 在 A 網站商品總數有800多個 <br>

　因此我向主管提出給我1個月時間，用下班時間跟假日寫程式來處理 A 網站的資料，若無成果的話，只好擠出一人來處理，而主管同意讓我試試看。<br>
　結果我花3個禮拜完成 Java 爬蟲，在不影響原本工作進度下，很有成就的解決了此事。
 
---
### - 開發過程 : <br>
我先分成兩部分依序進行<br>
```
1.先用 Jsoup 爬取資料
　- 遇到 Jsoup 訪問網址失敗，是 Jsoup 版本關係，遇到目標網址有HTTPS協議，訪問者未指定證書，才導致拋出異常。使用 validateTLSCertificates(false)，忽略證書驗證。
　- 因每個商品都有商品描述跟圖片連結兩個字串，思考回傳時有2種型態可選: 陣列、物件，我選擇前者。

2.再接著 Excel 讀寫
　- 先前舊的 Library 不是使用 Apache POI，因此先花點時間研究
```
### - 專案說明
API: JSOUP、Apache POI<br>
1.GrabDataToExcel.java - 產生給 TsetJsoup.java 使用的 Excel<br>
   在舊資料Excel裡的商品都被下架，無法給爬蟲使用，因此要做新的資料。而新資料的來源，我決定拿還在網站上的商品，但覺得用一筆筆複製貼上有點無趣，因此嘗試用爬蟲+Excel寫入資料的方式。<br>
   功能說明:新增 Excel ，在爬蟲去抓到所有商品名稱後，接著寫入 Excel ，用 FileOutputStream 到指定位置及名稱建立檔案。<br>
2.TsetJsoup.java <br>
   讀取 GrabDataToExcel.java 生成的 Excel 檔案，將讀取的內容用字串結合，是讓爬蟲去抓該商品的資料，因要放置多個欄位資料，所以我用陣列一次打包回傳回來，也是為了在寫入不同行時好拿值。
   
---   
### - 瓶頸，這是在舊的程式沒遇到的問題
---
###### 因為舊的資料裡的商品名稱大多是中文及不到10個含有英文的商品名稱
❌ 確認有從 Excel 讀取內容，但 Jsoup 訪問的網址卻一直不正確，發現 Excel 的商品名稱在 url 的商品名稱並非相同，才發現到它有規則。<br>
1. 有英文的會轉成小寫<br>
2. 因 url 在新增商品時，是記錄一開始設定的商品名稱，若日後更改商品名稱，url 的商品名稱不會變動，才導致無法訪問到正確網址。<br>

✔️ 解決辦法是<br>
1. 用 toLowerCase() 轉小寫
2. 使用正則表達式，過濾不必要的字，例:"(現貨+預購)"、"(預購)"、🔥。
---

### - 展示影片
 [![](http://img.youtube.com/vi/tAvU7IBmpLQ/0.jpg)](https://youtu.be/tAvU7IBmpLQ "VBA - 自動對帳程式")
